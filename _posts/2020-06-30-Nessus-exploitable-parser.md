---
published: false
---
Here's a simple Ruby script to parse Nessus .nessus files and output all exploitable vulnerabilities in tab separated values format for import into Excel.

![]({{site.baseurl}}/images/2020-06-30_17-00-56.png)

```ruby
#! /usr/bin/env ruby

require 'optparse'
require 'ruby-nessus'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: nessus.rb [options] [path]"

  opts.on('-f', '--file PATH', 'File path') { |v| options[:file_path] = v }
  opts.on('-d', '--directory PATH', 'Directory path to import multiple .nessus files') { |v| options[:dir_path] = v }

end.parse!

puts options[:file_path]
puts options[:dir_path]

# Print TSV Header
puts "Risk\tHost IP\tHostname\tPort\tName\tMetasploit Module\tReferences"

if options[:dir_path]
  Dir.glob("#{options[:dir_path]}/*.nessus").each do |f|
    ness = RubyNessus::Parse.new(f)
    ness.scan.each_host do |host|
      host.each_event do |event|
        if event.exploitability_ease == "No exploit is required"
          puts "#{event.risk}\t#{host.ip}\t#{host.hostname}\t#{event.port}\t#{event.name}\t#{event.metasploit_name}\t#{event.see_also}"
        elsif event.exploitability_ease == "Exploits are available"
          puts "#{event.risk}\t#{host.ip}\t#{host.hostname}\t#{event.port}\t#{event.name}\t#{event.metasploit_name}\t#{event.see_also}"
        end
      end
    end
  end
elsif options[:file_path]
  ness = RubyNessus::Parse.new("#{options[:file_path]}")
  ness.scan.each_host do |host|
    host.each_event do |event|
      if event.exploitability_ease == "No exploit is required"
        puts "#{event.risk}\t#{host.ip}\t#{host.hostname}\t#{event.port}\t#{event.name}\t#{event.metasploit_name}\t#{event.see_also}"
      elsif event.exploitability_ease == "Exploits are available"
        puts "#{event.risk}\t#{host.ip}\t#{host.hostname}\t#{event.port}\t#{event.name}\t#{event.metasploit_name}\t#{event.see_also}"
      end
    end
  end
end
```

